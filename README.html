<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<title>README</title>
<style>body{max-width:800px;margin:40px auto;font-family:sans-serif;line-height:1.7;padding:0 16px;}pre{background:#f6f8fa;padding:12px;border-radius:6px;overflow:auto;}code{background:#f6f8fa;padding:2px 4px;border-radius:4px;}h1,h2,h3{margin-top:2em;}table{border-collapse:collapse;}th,td{border:1px solid #ccc;padding:6px 12px;}blockquote{color:#555;border-left:4px solid #ddd;padding-left:12px;}</style>
</head>
<body>
<h1>英汉翻译Chrome插件</h1>
<p>一个支持音标显示和发音的英汉翻译Chrome插件。</p>
<h2>功能特性</h2>
<ul>
<li>🎯 双击单词快速翻译</li>
<li>🔤 <strong>支持中国人熟悉的中国音标（K12标准），也可一键切换回国际音标</strong></li>
<li>🔊 支持文本朗读和真人发音（带易懂图标）</li>
<li>🎨 现代化UI设计，交互直观优雅</li>
<li>🌍 <strong>智能用户检测</strong>：自动识别中国用户，提供优化的翻译服务</li>
<li>🔄 <strong>多API备用机制</strong>：确保翻译服务的稳定性和准确性</li>
<li>⚡ <strong>智能API选择</strong>：根据用户地理位置自动选择最优翻译API</li>
</ul>
<h2>主要界面与交互</h2>
<ul>
<li><strong>主弹窗顶部</strong>：显示选中单词（大号字体）、主发音按钮、国旗与箭头，整体美观。</li>
<li><strong>音标行</strong>：展示音标，后跟“真人发音”按钮（扬声器图标），按钮更易理解。</li>
<li><strong>音标类型切换</strong>：<ul>
<li>默认显示中国音标（K12标准），中国用户最熟悉，学习无障碍。</li>
<li>右侧有iOS风格toggle控件，点击即可在“中国音标/国际音标”间切换，满足不同学习/考试需求。</li>
<li>toggle控件小巧，状态一目了然，无需下拉菜单，交互极简。</li>
</ul>
</li>
<li><strong>所有按钮均有hover/点击反馈，操作流畅。</strong></li>
</ul>
<h2>项目结构</h2>
<pre><code>src/
  ├── manifest.json           # 插件配置文件
  ├── background.js           # 后台脚本（翻译API代理）
  ├── content.js              # 内容脚本（主要功能）
  ├── popup.html              # 弹窗界面
  ├── popup.js                # 弹窗逻辑
  └── icons/
      ├── icon-16.png
      ├── icon-48.png
      └── icon-128.png
release/                      # 构建产物目录
release.zip                   # 打包zip
node_modules/                 # 依赖目录
tests/                        # 测试目录
  ├── dj_phonetic_convert.test.js # DJ音标自动转换测试
  ├── translation.test.js     # 翻译解析测试
  └── run-tests.js            # 测试运行器
build.js                      # 构建脚本
package.json                  # 项目配置
README.md                     # 项目说明
PRIVACY_POLICY.md             # 隐私政策
.gitignore                    # Git忽略文件
</code></pre>
<h2>开发指南</h2>
<h3>安装依赖</h3>
<pre><code class="language-bash">cd chromeplugin
npm install
</code></pre>
<h3>运行测试</h3>
<pre><code class="language-bash">npm test
# 或直接运行
node tests/run-tests.js
</code></pre>
<h3>翻译API配置</h3>
<p>插件支持多种翻译API，根据用户地理位置智能选择：</p>
<ul>
<li><strong>中国用户</strong>：优先使用 MyMemory API，备用 Lingva API</li>
<li><strong>非中国用户</strong>：使用 Google Translate API</li>
<li><strong>音标和发音</strong>：统一使用 Free Dictionary API</li>
</ul>
<blockquote>
<p><strong>配置说明</strong>：中国用户优先使用MyMemory API（平均852ms），备用Lingva API（平均2552ms）；非中国用户使用Google翻译API（平均90ms）。所有API都保持100%成功率，确保翻译服务的稳定性。</p>
</blockquote>
<h3>代码重构亮点</h3>
<ul>
<li><strong>配置化API管理</strong>：使用 <code>TRANSLATION_APIS</code> 配置对象统一管理所有翻译API</li>
<li><strong>通用请求函数</strong>：通过 <code>makeApiRequest</code> 函数统一处理API请求和错误</li>
<li><strong>智能用户检测</strong>：基于语言和时区自动识别中国用户</li>
<li><strong>多级备用机制</strong>：确保翻译服务的稳定性和准确性</li>
</ul>
<h3>构建发布</h3>
<pre><code class="language-bash">npm run build:test   # 运行测试后构建
npm run build        # 仅构建
npm run build:zip    # 构建并打包为release.zip
npm run zip          # 只打包release目录为zip
npm run clean        # 清理发布目录
</code></pre>
<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>所有源码和资源文件都在 <code>src/</code> 目录下，图标在 <code>src/icons/</code>。</li>
<li>构建和打包命令会自动从 <code>src/</code> 复制所需文件到 <code>release/</code>。</li>
<li>manifest.json 及相关路径均为相对 <code>src/</code> 目录。</li>
<li><code>npm run gen:html</code> 可将 <code>README.md</code> 和 <code>PRIVACY_POLICY.md</code> 转换为 html。</li>
</ul>
</blockquote>
<h2>测试系统</h2>
<ul>
<li><strong>DJ音标自动转换测试</strong>：批量验证IPA到中国K12标准DJ音标的自动转换准确率。</li>
<li><strong>翻译解析测试</strong>：验证Google翻译和Free Dictionary API的解析逻辑，确保主字段（单词、音标、发音链接）提取准确。</li>
<li><strong>翻译API测试</strong>：验证多API配置和备用机制的可靠性。</li>
<li><strong>性能测试</strong>：定期测试各翻译API的响应速度和稳定性，确保最佳用户体验。</li>
</ul>
<h3>运行测试</h3>
<pre><code class="language-bash">npm test
# 或单独运行
node tests/dj_phonetic_convert.test.js
node tests/translation.test.js
</code></pre>
<h3>性能测试结果</h3>
<p>基于实际测试的API性能对比（10个常用单词测试）：</p>
<table>
<thead>
<tr>
<th>API</th>
<th>平均响应时间</th>
<th>成功率</th>
<th>性能评级</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Google翻译API</strong></td>
<td>90ms</td>
<td>100%</td>
<td>🟢 优秀</td>
</tr>
<tr>
<td><strong>MyMemory API</strong></td>
<td>852ms</td>
<td>100%</td>
<td>🟡 良好</td>
</tr>
<tr>
<td><strong>Lingva API</strong></td>
<td>2552ms</td>
<td>100%</td>
<td>🔴 较慢</td>
</tr>
</tbody></table>
<p><strong>性能特点</strong>：</p>
<ul>
<li>Google翻译API响应最快（90ms），适合非中国用户</li>
<li>MyMemory API响应较快（852ms），适合中国用户主要使用</li>
<li>Lingva API响应较慢（2552ms），作为中国用户备用</li>
<li>所有API都保持100%成功率，稳定性优秀</li>
</ul>
<h2>发布流程</h2>
<ol>
<li><strong>运行测试</strong>：确保所有功能正常<pre><code class="language-bash">npm test
</code></pre>
</li>
<li><strong>构建并打包发布文件</strong>：生成干净的 <code>release.zip</code> 包<pre><code class="language-bash">npm run build:zip
</code></pre>
</li>
<li><strong>检查发布包</strong>：确认 <code>release.zip</code> 内包含所需文件<ul>
<li>manifest.json</li>
<li>background.js</li>
<li>content.js</li>
<li>popup.html</li>
<li>popup.js</li>
<li>icons/</li>
</ul>
</li>
<li><strong>上传插件</strong>：将 <code>release.zip</code> 上传到 Chrome Web Store</li>
</ol>
<h2>注意事项</h2>
<ul>
<li>测试文件位于 <code>tests/</code> 目录，不会被包含在发布包中</li>
<li>构建脚本会自动排除测试相关文件</li>
<li>发布前请确保所有测试通过</li>
<li>音标转换规则基于中国K12标准和国际IPA标准</li>
</ul>
<h2>技术栈</h2>
<ul>
<li>Chrome Extension Manifest V3</li>
<li>原生JavaScript</li>
<li><strong>多翻译API集成</strong>：<ul>
<li>Google Translate API（非中国用户，平均90ms响应时间）</li>
<li>MyMemory API（中国用户主要，平均852ms响应时间）</li>
<li>Lingva API（中国用户备用，平均2552ms响应时间）</li>
<li>Free Dictionary API（音标和发音）</li>
</ul>
</li>
<li>Web Speech API（浏览器内置语音合成）</li>
<li><strong>智能用户检测</strong>：基于语言和时区的地理位置识别</li>
</ul>
<h2>许可证</h2>
<p>MIT License </p>

</body>
</html>